# Bakery - Agent Instructions

## Cursor Cloud specific instructions

### Project overview

Bakery is a recipe management platform for at-home bakers. It is a pnpm monorepo managed by Turborepo with three packages:
- `apps/web` — Next.js 16 frontend (App Router, React 19, Tailwind CSS, Shadcn UI)
- `packages/backend` — Convex backend (schema, mutations, queries, file storage)
- `packages/shared` — Shared utilities, Zod validation, constants

### Required secrets

The app depends on two external SaaS services. Without valid credentials, the app cannot authenticate users or persist data:

| Secret | Location | Purpose |
|--------|----------|---------|
| `NEXT_PUBLIC_CONVEX_URL` | `apps/web/.env.local` | Convex deployment URL |
| `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY` | `apps/web/.env.local` | Clerk auth (public) |
| `CLERK_SECRET_KEY` | `apps/web/.env.local` | Clerk auth (server) |
| `CLERK_JWT_ISSUER_DOMAIN` | `apps/web/.env.local` | Clerk JWT validation |
| `CONVEX_DEPLOYMENT` | `packages/backend/.env.local` | Convex dev deployment ID |
| `CONVEX_URL` | `packages/backend/.env.local` | Convex deployment URL |

These `.env.local` files are gitignored. See `.env.example` files in `apps/web/` and `packages/backend/` for templates.

### Running services

Standard commands are in root `package.json` and documented in the cursor rule at `.cursor/rules/bakery.mdc`:

- **Next.js dev server**: `pnpm dev` (starts on port 3000)
- **Convex dev server**: `pnpm convex:dev` (must run in a separate terminal)
- Both must run simultaneously for the app to function end-to-end

### Key caveats

- **Build requires valid Clerk keys**: `pnpm build` pre-renders pages that invoke Clerk middleware. Placeholder/missing keys cause the build to fail. Dev mode (`pnpm dev`) still starts and compiles pages, but all requests return 500 until valid keys are provided.
- **Build scripts approval**: The `pnpm.onlyBuiltDependencies` field in root `package.json` allows `@clerk/shared`, `esbuild`, `sharp`, and `unrs-resolver` to run postinstall scripts. Without this, pnpm ignores their build scripts and the app may not work correctly.
- **Lint has pre-existing warnings/errors**: `pnpm lint` currently reports pre-existing issues (unescaped entities, img elements, unused vars). These are in the existing codebase.
- **Format check flags generated files**: `pnpm format:check` may flag files in `packages/backend/convex/_generated/` — these are auto-generated by Convex and can be reformatted with `pnpm format`.
